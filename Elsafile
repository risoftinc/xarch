# Elsa - Engineer's Little Smart Assistant
# This file defines custom commands for your project
# Commands can be run using: elsa command_name or elsa run command_name

# Install elsa cli
install-tools:
	go install go.risoftinc.com/elsa/cmd/elsa@latest

# Build the project
build:
	go build -o bin/app .

# Run tests
test:
	go test ./...

# Clean build artifacts
clean:
	rm -rf bin/
	go clean

# Install dependencies
deps:
	go mod download
	go mod tidy

# Run the application
run:
	go run .

# Run the application in development mode via elsa watch
run/dev:
	elsa watch "cls & go run ."

# Format code
fmt:
	go fmt ./...
	go vet ./...

# For Migration
ddl-create:
	elsa migration create ddl ${?MIGRATION_NAME:Enter your migration ddl name}

dml-create:
	elsa migration create dml ${?MIGRATION_NAME:Enter your migration dml name}

seed:
	go run cmd/seeder/main.go -type=all

# Generate proto files
proto:
	protoc --go_out=. --go_opt=paths=source_relative --go-grpc_out=. --go-grpc_opt=paths=source_relative infrastructure/grpc/proto/*.proto

# For make 
make-generate:
	elsa make list
	elsa make ${?TEMPLATE_TYPE:Enter your template type} ${?NAME:Enter naming convention}

# Build the project with docker
docker-build:
	echo exposed port api  : ${?HOST_API:Enter your host api}
	echo exposed port grpc : ${?HOST_GRPC:Enter your host grpc}
	docker-compose --env-file ${?ENV_FILE:Enter your env file} up --build
